@startuml 

    actor User 
    participant "GlobalSearchSideBar" as UI
    participant "f : Filter" as ft
    participant "UIController" as UIctrl
    participant "GlobalSearchCtrl" as ctrl
    participant "Spreadsheet" as sheet
    participant "Cell" as cll
    participant "RegexUtilExtended" as util
    participant "SearchPublisher" <<Singleton>>
    

    User -> UI : Press filters button
    UI -> ctrl: List<Value.types> types=getTypes()
    User <-- UI : Show the available cell types
    User -> UI : Selects the cell types to include in the search
    UI -> ctrl: insertTypes(List<Value.Type> types)
    loop
    User <-- UI : Ask for the formula to include in the search
    User -> UI : Insert the formula
    UI->ctrl: Formula formula = validateFormula(String formula) 
    UI -> ctrl: insertFormula(formula)
    end
    User <-- UI : Ask if the comments are to be included
    User -> UI : Activate comments in the search
    UI->ctrl : activateComments()
    create ft
    ctrl-->ft: create(formulas,types,true)
    User -> UI : Inserts regular expression
    UI -> ctrl : checkIfValid(String regex)
    ctrl -> UIctrl : Stack<Workbook> stackWorkbooks : getActiveWorkbooks()
    create util 
    ctrl -> util: create(f,stackWorkbooks)
    ctrl -> util : isRegexValid(regex)
    ctrl -> util : setRegex(regex)
    ctrl -> util : searchInWorkbooks()
    loop for Workbooks b :  stackWorkbooks
    loop for Spreadsheet s : listSpreadsheets
    loop for Cells c : listCells
    util -> cll : getValue()
    alt : if comments activated
    util -> util : checkIfMatches(String cellContent)
    util -> util : checkIfCommentMatches(String commentContent)
    else : case comments are desactivated
    util -> util : checkIfMatches(String cellContent)
    end
    alt : if true
    util-> SearchPublisher : notifyObservers(TODO)
    end
    end
    end
    end
    UI -> UI : update()
    UI-->User: Show search results

    
@enduml
